<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Profile — Dark</title>
<style>
:root{--dark-bg:#0f1720;--card:#111219;--muted:#9aa4b2;--accent:#6e8ef5;--accent-2:#5A67D8;--radius:12px;--gap:16px;}
html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
body{background: linear-gradient(180deg,#071020 0%, #0b1420 100%); color:#e6eef8; padding:20px;}
#page{max-width:980px;margin:0 auto;}
.card{background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); border-radius:var(--radius); padding:18px; box-shadow:0 8px 30px rgba(2,6,23,0.6);}
.header-row{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap;}
.meta{display:flex;gap:12px;align-items:center;min-width:0;}
.avatar{width:84px;height:84px;border-radius:999px;flex:0 0 84px;background:linear-gradient(135deg,#2b3bff22,#8b5cf622);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:34px;color:#eaf0ff;overflow:hidden;position:relative;border: 2px solid rgba(255,255,255,0.04);}
.avatar img{width:100%;height:100%;object-fit:cover;display:block;}
.profile-info{min-width:0;}
.profile-info input[type="text"]{background:transparent;border:none;color:var(--muted);font-size:20px;font-weight:700;outline:none;width:100%;}
.small{color:var(--muted);font-size:13px;margin-top:4px;}
.controls{display:flex;gap:8px;flex-wrap:wrap;}
.btn{padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700;background:var(--accent);color:white;display:inline-flex;align-items:center;gap:8px;}
.btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);}
.btn.ghost{background:transparent;color:var(--muted);border:none;}
#about-grid{display:grid;grid-template-columns:1fr 300px;gap:16px;margin-top:16px;align-items:start;}
.about,.stats{background:transparent;padding:0;}
.section-title{font-weight:700;font-size:16px;margin:0 0 8px 0;color:#e9f0ff;}
.muted{color:var(--muted);font-size:14px;margin-top:6px;}
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:8px;}
.stat{background: rgba(255,255,255,0.02);padding:10px;border-radius:10px;text-align:center;}
.stat .num{font-weight:800;font-size:18px;color:white;}
.stat .label{color:var(--muted);font-size:13px;margin-top:6px;}
#posts{margin-top:18px;}
.post-card{background: rgba(255,255,255,0.02);padding:12px;border-radius:10px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.03);}
.post-card img, .post-card video { max-height:160px; border-radius:8px; display:block; margin-top:8px;}
.photo-showcase-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px;}
.photo-item{background: rgba(255,255,255,0.01); height:80px; border-radius:8px; display:flex; align-items:center; justify-content:center; color:var(--muted); font-weight:600;}
@media(min-width:768px){.avatar{width:100px;height:100px;}.profile-info input[type="text"]{font-size:24px;}#about-grid{grid-template-columns:1fr 360px;}.photo-showcase-grid{grid-template-columns: repeat(6,1fr);}}
@media(max-width:640px){#about-grid{grid-template-columns:1fr;}.stats-grid{grid-template-columns:repeat(3,1fr);}.controls{width:100%;justify-content:flex-end;}}
.hidden{display:none!important;}
.muted-small{color:var(--muted);font-size:12px;}
</style>
</head>
<body>
<div id="page">
  <div class="card" id="profileCard">
    <div class="header-row">
      <div class="meta">
        <div class="avatar" id="avatar">U</div>
        <div class="profile-info">
          <input type="text" id="nameInput" placeholder="Your name" />
          <div id="email" class="small"></div>
          <div style="margin-top:8px"><span id="followersCount">0</span> followers · <span id="followingCount">0</span> following</div>
        </div>
      </div>
      <div class="controls">
        <button id="followBtn" class="btn">Follow</button>
        <button id="updateBtn" class="btn secondary">Update Profile</button>
        <button id="changePfpBtn" class="btn secondary">Change PFP</button>
        <button id="homeBtn" class="btn ghost">Home</button>
      </div>
    </div>

    <div id="about-grid">
      <div class="about">
        <h3 class="section-title">About Me</h3>
        <p class="muted" id="aboutText">—</p>
        <div style="display:flex;gap:10px;margin-top:14px;">
          <div style="display:flex;flex-direction:column;">
            <small class="muted-small">Location</small>
            <div class="muted" id="location">—</div>
          </div>
          <div style="display:flex;flex-direction:column;">
            <small class="muted-small">Joined</small>
            <div class="muted" id="joined">—</div>
          </div>
        </div>
        <div style="margin-top:14px">
          <h4 class="section-title" style="font-size:14px;margin-bottom:8px;">My Latest Work</h4>
          <div class="photo-showcase-grid" id="workGrid">
            <div class="photo-item">Blank</div>
            <div class="photo-item">Blank</div>
            <div class="photo-item">Blank</div>
            <div class="photo-item hidden">Blank</div>
            <div class="photo-item hidden">Blank</div>
            <div class="photo-item hidden">Blank</div>
          </div>
        </div>
      </div>
      <div class="stats">
        <h3 class="section-title">Quick Stats</h3>
        <div class="stats-grid">
          <div class="stat">
            <div class="num" id="statFollowers">0</div>
            <div class="label">Followers</div>
          </div>
          <div class="stat">
            <div class="num" id="statFollowing">0</div>
            <div class="label">Following</div>
          </div>
          <div class="stat">
            <div class="num" id="statViews">0</div>
            <div class="label">Views this Week</div>
          </div>
        </div>
        <div style="margin-top:14px">
          <button id="editAboutBtn" class="btn secondary" style="width:100%;">Edit About</button>
        </div>
      </div>
    </div>

    <div id="posts">
      <h3 style="margin:16px 0 8px 0;">Posts</h3>
      <div id="userPosts" class="posts-list"></div>
    </div>

    <input type="file" id="pfpInput" style="display:none" accept="image/*"/>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getAuth, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
import {
  getFirestore, doc, getDoc, setDoc, deleteDoc,
  collection, query, where, orderBy, getDocs, onSnapshot
} from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCRS5SkPr3yGTiHsuY3Bk3IyuS8k88O878",
  authDomain: "swipe-f90ed.firebaseapp.com",
  projectId: "swipe-f90ed",
  storageBucket: "swipe-f90ed.appspot.com",
  messagingSenderId: "360540214416",
  appId: "1:360540214416:web:3e92fe77e5c93283d47415",
  measurementId: "G-4SV32V4N0N"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const urlParams = new URLSearchParams(window.location.search);
const profileUid = urlParams.get('uid');

let currentUser = null;
const userPosts = document.getElementById('userPosts');

function escapeHtml(s){ return s?.replace(/[&<>]/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[m])) ?? ''; }
function formatTime(ts){ try{return ts?.toDate().toLocaleString()||'Just now'}catch{return 'Just now'}}

async function renderPostCard(postId,data){
  const card = document.createElement('div');
  card.className='post-card';

  card.innerHTML = `
    <div style="font-weight:700">${data.name || 'User'}</div>
    <div style="font-size:12px;color:#9aa4b2;margin-top:4px">${formatTime(data.createdAt)}</div>
    <div style="margin-top:8px">${escapeHtml(data.text || '')}</div>
    <div id="media-${postId}"></div>
  `;
  const mediaBox = card.querySelector(`#media-${postId}`);
  if(data.mediaUrls?.length){
    data.mediaUrls.forEach(url=>{
      if(url.match(/\.(mp4|webm|ogg)$/i)){
        const video = document.createElement('video');
        video.src=url; video.controls=true; video.style.maxHeight='160px'; video.style.borderRadius='8px';
        mediaBox.appendChild(video);
      }else{
        const img=document.createElement('img');
        img.src=url; img.style.maxHeight='160px'; img.style.borderRadius='8px';
        mediaBox.appendChild(img);
      }
    });
  }
  userPosts.appendChild(card);
}

async function loadUserPosts(){
  if(!profileUid) return;
  userPosts.innerHTML='Loading posts…';
  const q = query(collection(db,'posts'), where('uid','==',profileUid), orderBy('createdAt','desc'));
  const snap = await getDocs(q);
  userPosts.innerHTML='';
  if(snap.empty){ userPosts.textContent='No posts yet'; return; }
  snap.forEach(d=>renderPostCard(d.id,d.data()));
}

onAuthStateChanged(auth,u=>{
  currentUser=u;
  if(!u){ location.href='index.html'; return; }
  loadUserPosts();
});
</script>
</body>
</html>
