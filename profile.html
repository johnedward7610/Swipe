<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Profile</title>

<!-- Firebase SDKs -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

  // âœ… Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCRS5SkPr3yGTiHsuY3Bk3IyuS8k88O878",
    authDomain: "swipe-f90ed.firebaseapp.com",
    projectId: "swipe-f90ed",
    storageBucket: "swipe-f90ed.firebasestorage.app",
    messagingSenderId: "360540214416",
    appId: "1:360540214416:web:3e92fe77e5c93283d47415",
    measurementId: "G-4SV32V4N0N"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  window.auth = auth;
  window.db = db;
</script>

<style>
body {
  margin:0;
  font-family:"Inter",sans-serif;
  background:#f4f6ff;
  color:#1b1b1b;
  transition: background 0.3s, color 0.3s;
}

body.dark {
  background:#0f1117;
  color:#ffffff;
}

.container {
  max-width:500px;
  margin:50px auto;
  padding:30px;
  background:#fff;
  border-radius:20px;
  box-shadow:0 8px 25px rgba(0,0,0,0.08);
  transition: background 0.3s, color 0.3s;
}

body.dark .container {
  background:#141821;
}

h1 {
  text-align:center;
  margin-bottom:20px;
}

.info {
  margin-bottom:15px;
  font-size:16px;
}

.logout-btn, .theme-toggle {
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  margin-top:10px;
  transition: background 0.25s;
}

.logout-btn {
  background:#6e8ef5;
  color:white;
}

.logout-btn:hover {
  background:#a8b7ff;
}

.theme-toggle {
  background:transparent;
  color:inherit;
  margin-top:0;
  margin-bottom:20px;
}
</style>
</head>

<body>
<div class="container">
  <button class="theme-toggle" id="themeToggle">ðŸŒ™</button>
  <h1>Your Profile</h1>
  <div class="info"><strong>Full Name:</strong> <span id="profileName">Loading...</span></div>
  <div class="info"><strong>Email:</strong> <span id="profileEmail">Loading...</span></div>
  <div class="info"><strong>Gender:</strong> <span id="profileGender">Loading...</span></div>

  <button class="logout-btn" id="logoutBtn">Log Out</button>
</div>

<script type="module">
const auth = window.auth;
const db = window.db;

const profileName = document.getElementById("profileName");
const profileEmail = document.getElementById("profileEmail");
const profileGender = document.getElementById("profileGender");

// ================= DARK MODE =================
const themeToggle = document.getElementById("themeToggle");
themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark");
  themeToggle.textContent = document.body.classList.contains("dark") ? "â˜€" : "ðŸŒ™";
});

// ================= AUTH CHECK =================
onAuthStateChanged(auth, async (user) => {
  if (user) {
    console.log("Logged in user UID:", user.uid);

    try {
      const docRef = doc(db, "users", user.uid);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        const data = docSnap.data();
        console.log("Firestore data:", data);

        // Safely assign data with fallback
        profileName.textContent = data.fullName || "Not provided";
        profileEmail.textContent = data.email || user.email || "Not provided";
        profileGender.textContent = data.gender || "Not provided";

      } else {
        console.warn("No document found for this UID!");
        profileName.textContent = "Not provided";
        profileEmail.textContent = user.email || "Not provided";
        profileGender.textContent = "Not provided";
      }
    } catch (error) {
      console.error("Error fetching user data:", error);
      profileName.textContent = "Error loading";
      profileEmail.textContent = "Error loading";
      profileGender.textContent = "Error loading";
    }

  } else {
    // Redirect to login if not logged in
    window.location.href = "index.html";
  }
});

// ================= LOGOUT =================
document.getElementById("logoutBtn").addEventListener("click", async () => {
  await signOut(auth);
  window.location.href = "index.html";
});
</script>
</body>
</html>
